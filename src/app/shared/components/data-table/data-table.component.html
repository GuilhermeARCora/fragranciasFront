<div class="filter-container">
  <mat-form-field class="filter-field" appearance="outline">
    <mat-label>Filtrar</mat-label>
    <input
      matInput
      (ngModelChange)="applyFilter()"
      [(ngModel)]="filterValue"
      placeholder="Buscar..."
      id="input-filter"
    />

    @if(filterValue){
    <button
      mat-icon-button
      matSuffix
      aria-label="Clear"
      (click)="clearFilter()"
      class="border-0 bg-transparent pe-3"
      type="button"
      id="btn-close"
    >
      <mat-icon>close</mat-icon>
    </button>
   }
  </mat-form-field>
</div>

<div class="table-wrapper shadow-lg">

  <div class="table-container">
    <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">

      <!-- Colunas dinâmicas -->
      @for (column of columnsToDisplay; track column.key; let i = $index) {
        <ng-container [matColumnDef]="column.key">
          <th
            mat-header-cell
            *matHeaderCellDef
            mat-sort-header
            sticky
            [id]="'header-' + column.key"
            [class]="'header-col-' + column.key"
          >
            {{ column.label }}
          </th>
          <td
            mat-cell
            *matCellDef="let element"
            [id]="'cell-' + column.key + '-' + element._id"
            [class]="'cell-col-' + column.key"
          >
            {{ formatValue(column, element[column.key]) }}
          </td>
        </ng-container>
      }

      <!-- Coluna de ações -->
      <ng-container matColumnDef="actions">
        <th
          mat-header-cell
          *matHeaderCellDef
          sticky
          id="header-actions"
          class="header-col-actions"
        >
          Ações
        </th>
        <td
          mat-cell
          *matCellDef="let element"
          [id]="'cell-actions-' + element._id"
        >
        @if(useBtnEdit){
          <button
            matTooltip="Editar"
            matTooltipPosition="below"
            mat-icon-button
            color="primary"
            (click)="onEdit(element)"
            [id]="'edit-' + element._id"
            class="btn border-0 bg-primary rounded-5 text-white p-1 me-1"
          >
            <mat-icon class="d-flex">edit</mat-icon>
          </button>
        }

        @if(useBtnActive){
          <button
            [matTooltip]="element.active === true ? 'Desativar': 'Ativar'"
            matTooltipPosition="below"
            mat-icon-button
            color="warn"
            (click)="onChangeActive(element)"
            [id]="'active-' + element._id"
            class="btn border-0 rounded-5 text-white p-1 me-1"
            [ngClass]="{
              'bg-success': element.active === true,
              'bg-danger': element.active === false
            }"
          >
          @if(element.active === true){
            <mat-icon class="d-flex">check_circle</mat-icon>
          } @else{
            <mat-icon class="d-flex">cancel</mat-icon>
          }
          </button>
        }

        @if(useBtnRemove){
          <button
            matTooltip="Excluir"
            matTooltipPosition="below"
            mat-icon-button
            color="warn"
            (click)="onChangeRemove(element)"
            [id]="'remove-' + element._id"
            class="btn border-0 bg-danger text-white rounded-5 p-1"
          >
            <mat-icon class="d-flex">delete</mat-icon>
          </button>
        }

        @if(useBtnStatus){
          <button
            matTooltip="Mudar o status"
            matTooltipPosition="below"
            mat-icon-button
            color="warn"
            (click)="onChangeStatus(element)"
            [id]="'status-' + element._id"
            class="btn border-0 bg-white text-dark rounded-5 p-1 me-1"
          >
            <mat-icon class="d-flex">autorenew</mat-icon>
          </button>
        }

        @if(useBtnLink){
          <button
            matTooltip="Ir para outra página"
            matTooltipPosition="below"
            mat-icon-button
            color="warn"
            (click)="onChangeLink(element)"
            [id]="'link-' + element._id"
            class="btn border-0 bg-white text-dark rounded-5 p-1"
          >
            <mat-icon class="d-flex">open_in_new</mat-icon>
          </button>
        }

        </td>
      </ng-container>

      <!-- Headers e Rows -->
      <tr
        mat-header-row
        *matHeaderRowDef="columnKeys.concat(['actions']); sticky: true"
        id="header-row"
      ></tr>

      <tr
        mat-row
        *matRowDef="let row; columns: columnKeys.concat(['actions'])"
        [id]="'row-' + row._id"
        [class]="'data-row-' + row._id"
        [ngClass]="{
          'row-concluido': row.status === 'CONCLUIDO',
          'row-pendente': row.status === 'PENDENTE',
          'row-cancelado': row.status === 'CANCELADO'
        }"
      ></tr>

    </table>
  </div>

  <mat-paginator [pageSizeOptions]="[10, 15, 20]" showFirstLastButtons></mat-paginator>
</div>
