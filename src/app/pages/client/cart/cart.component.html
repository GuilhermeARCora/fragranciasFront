@let isHandset = (breakPointService.isHandset$ | async);
@let cartItems = (cartItems$ | async);
@let cartFullPrice = (cartService.cartFullPriceTotal$ | async) ?? 0;
@let cartCurrentPrice = (cartService.cartCurrentPriceTotal$ | async) ?? 0;
@let cartPixPrice = (cartService.cartPixPriceTotal$ | async) ?? 0;
@let cartTotalDiscount = (cartDiscountTotal$ | async) ?? 0;
@let cartDiscountDecimal = (cartFullPrice - cartCurrentPrice)/cartFullPrice;
@let isViewMode = viewMode();
@let isAdmin = this.authService.currentUser?.role;

<app-layout>

  <section class="d-md-flex flex-md-row gap-md-3">

    <div class="d-flex justify-content-center mt-5 card-items">

      <div [ngClass]=" isHandset ? 'd-flex flex-column gap-5' : 'd-flex flex-wrap gap-3 justify-content-evenly'">
          @for(item of cartItems ; track item.product._id){
          <app-cart-item
            [product]="item.product"
            [amount]="item.amount"
            [isModoView]="isViewMode"
          />
          }
      </div>

    </div>

    <div class="d-flex flex-column mt-5 mx-2 rounded-3 cart-info sticky">

      <div class="d-flex flex-column justify-content-between">

        <div class="d-flex justify-content-between align-items-center">
         <h2>Subtotal</h2>
         <p>{{ cartFullPrice | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}</p>
        </div>

        <div class="d-flex justify-content-between align-items-center">
          <h5>Desconto total</h5>
          <p>({{cartDiscountDecimal | percent:'1.0-2'}}) - {{cartTotalDiscount | currency:'BRL':'symbol':'1.2-2':'pt-BR'}}</p>
        </div>

      </div>

      <hr class="bg-dark border-black">

      <div class="d-flex flex-column gap-3">

        <div class="d-flex flex-column">

          <div class="d-flex justify-content-between align-items-center">
            <h2>Total</h2>
            <p>{{cartCurrentPrice | currency:'BRL':'symbol':'1.2-2':'pt-BR'}}</p>
          </div>

          <div class="d-flex justify-content-between align-items-center">
            <h5>Via Pix</h5>
            <p class="pix-price">{{cartPixPrice | currency:'BRL':'symbol':'1.2-2':'pt-BR'}}</p>
          </div>

        </div>

        @if(!isViewMode){
        <div class="d-flex flex-column">

          <div class="">
            <button
              type="button"
              id="btn-checkout"
              class="btn btn-success w-100 fw-bold rounded-2"
              (click)="isClient()"
            >
              CHECKOUT
            </button>
          </div>

          <div class="">
            <button
              class="btn btn-outline-dark w-100 fw-bold rounded-2 mt-2"
              type="button"
              id="btn-keep-shopping"
              (click)="redirectBack()"
            >
              CONTINUAR COMPRANDO
            </button>
          </div>

        </div>
        }

        @if(isAdmin){
        <div>
          <button
            (click)="endOrder()"
            type="button"
            id="btn-end-order"
            class="btn btn-warning w-100 fw-bold rounded-2 mt-2"
          >
            FINALIZAR PEDIDO
          </button>
        </div>
        }

      </div>

    </div>

  </section>

</app-layout>
